<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mistral Vibe</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <!-- Dark mode highlight.js theme -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/styles/github.min.css" id="hljs-light">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/styles/github-dark.min.css" id="hljs-dark" disabled>
    <!-- Markdown rendering -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- HTML sanitization for XSS protection -->
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script>
    <!-- Syntax highlighting -->
    <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/highlight.min.js"></script>
</head>
<body>
    <div class="app-container">
        <!-- Mobile Header -->
        <header class="mobile-header">
            <button class="menu-toggle" id="menuToggle" aria-label="Toggle menu">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 12h18M3 6h18M3 18h18"/>
                </svg>
            </button>
            <span class="mobile-title">Mistral Vibe</span>
            <button class="theme-toggle" id="themeToggleMobile" aria-label="Toggle theme">
                <svg class="sun-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
                </svg>
                <svg class="moon-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                </svg>
            </button>
        </header>

        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar" role="complementary" aria-label="Session navigation">
            <div class="sidebar-header">
                <div class="logo" role="banner">
                    <span class="logo-icon" aria-hidden="true">V</span>
                    <span class="logo-text">Mistral Vibe</span>
                </div>
                <button class="theme-toggle desktop-only" id="themeToggle" aria-label="Toggle theme">
                    <svg class="sun-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                        <circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
                    </svg>
                    <svg class="moon-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                    </svg>
                </button>
            </div>

            <button class="new-session-btn" id="newSessionBtn">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 5v14M5 12h14"/>
                </svg>
                New Chat
            </button>

            <!-- Session Search -->
            <div class="session-search">
                <label for="sessionSearch" class="visually-hidden">Search sessions</label>
                <input type="text" id="sessionSearch" placeholder="Search sessions..." aria-label="Search sessions" />
            </div>

            <nav class="sessions-section" aria-label="Chat sessions">
                <h3 class="sessions-title" id="sessions-heading">Sessions</h3>
                <ul class="sessions-list" id="sessionsList" role="list" aria-labelledby="sessions-heading">
                    <!-- Sessions will be populated here -->
                </ul>
            </nav>

            <div class="sidebar-footer">
                <div class="model-selector" id="modelSelector">
                    <label class="model-label" for="modelSelect">Model:</label>
                    <select id="modelSelect" class="model-select" aria-label="Select AI model">
                        <!-- Models populated dynamically -->
                    </select>
                </div>
            </div>
        </aside>

        <!-- Sidebar Overlay for Mobile -->
        <div class="sidebar-overlay" id="sidebarOverlay" aria-hidden="true"></div>

        <!-- Main Content -->
        <main class="main-content" role="main">
            <!-- Welcome screen (shown when no session is active) -->
            <div class="welcome-screen" id="welcomeScreen">
                <div class="welcome-content">
                    <div class="welcome-logo">
                        <span class="logo-icon large">V</span>
                    </div>
                    <h1>Welcome to Mistral Vibe</h1>
                    <p>Your AI-powered coding assistant</p>
                    <button class="start-btn" id="startChatBtn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                        </svg>
                        Start a new chat
                    </button>
                </div>
            </div>

            <!-- Chat container (shown when session is active) -->
            <div class="chat-container hidden" id="chatContainer">
                <div class="chat-header">
                    <div class="chat-header-left">
                        <h2 class="session-name" id="sessionName" contenteditable="false">New Chat</h2>
                        <button class="rename-btn" id="renameBtn" title="Rename session" aria-label="Rename session">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                            </svg>
                        </button>
                        <button class="delete-btn" id="deleteSessionBtn" title="Delete session" aria-label="Delete session">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                            </svg>
                        </button>
                    </div>
                    <div class="chat-header-right">
                        <div class="session-stats" id="sessionStats"></div>
                    </div>
                </div>

                <div class="messages-container" id="messagesContainer">
                    <div class="messages" id="messages" role="log" aria-live="polite" aria-label="Chat messages">
                        <!-- Messages will be populated here -->
                    </div>

                    <!-- Streaming Indicator -->
                    <div class="streaming-status hidden" id="streamingStatus" role="status" aria-live="polite">
                        <div class="streaming-indicator" aria-hidden="true">
                            <span class="dot"></span>
                            <span class="dot"></span>
                            <span class="dot"></span>
                        </div>
                        <span class="streaming-text">Thinking...</span>
                    </div>
                </div>

                <!-- File Preview Area -->
                <div class="file-preview-container hidden" id="filePreviewContainer">
                    <div class="file-preview-list" id="filePreviewList">
                        <!-- File previews will be added here -->
                    </div>
                </div>

                <div class="input-container" id="inputContainer">
                    <div class="input-wrapper" id="inputWrapper">
                        <!-- File Input (hidden) -->
                        <input type="file" id="fileInput" multiple accept="image/*,.pdf,.txt,.md,.py,.js,.ts,.json,.yaml,.yml,.xml,.html,.css" hidden aria-label="Upload files" />

                        <!-- Input Tools -->
                        <div class="input-tools" role="toolbar" aria-label="Message tools">
                            <button class="tool-btn" id="attachBtn" title="Attach files" aria-label="Attach files">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                                    <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/>
                                </svg>
                            </button>
                            <button class="tool-btn" id="searchToggle" title="Toggle web search" aria-label="Toggle web search" aria-pressed="false">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                                    <circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/>
                                </svg>
                            </button>
                        </div>

                        <label for="messageInput" class="visually-hidden">Message input</label>
                        <textarea
                            id="messageInput"
                            placeholder="Ask me anything..."
                            rows="1"
                            aria-label="Type your message"
                            aria-describedby="input-hint"
                        ></textarea>

                        <button class="send-btn" id="sendBtn" disabled aria-label="Send message">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                                <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/>
                            </svg>
                        </button>
                    </div>

                    <!-- Search Active Indicator -->
                    <div class="search-indicator hidden" id="searchIndicator">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/>
                        </svg>
                        <span>Web search enabled</span>
                        <button class="search-close" id="searchClose">&times;</button>
                    </div>

                    <div class="input-hint" id="input-hint">
                        <span>Press <kbd>Enter</kbd> to send, <kbd>Shift+Enter</kbd> for new line</span>
                        <span class="drag-hint">Drop files here to attach</span>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Tool Approval Modal -->
    <div class="modal hidden" id="approvalModal" role="alertdialog" aria-modal="true" aria-labelledby="approval-title">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="approval-title">Tool Approval Required</h3>
                <button class="modal-close" id="approvalClose" aria-label="Close dialog">&times;</button>
            </div>
            <div class="modal-body">
                <div class="tool-info">
                    <span class="tool-label">Tool:</span>
                    <span class="tool-name" id="approvalToolName"></span>
                </div>
                <div class="tool-args-section">
                    <span class="tool-label">Arguments:</span>
                    <pre class="tool-args" id="approvalToolArgs"></pre>
                </div>
            </div>
            <div class="modal-footer">
                <label class="always-allow" for="alwaysAllowCheck">
                    <input type="checkbox" id="alwaysAllowCheck" />
                    Always allow this tool (saves to config)
                </label>
                <div class="modal-actions">
                    <button class="btn btn-secondary" id="denyToolBtn">Deny</button>
                    <button class="btn btn-primary" id="approveToolBtn">Approve</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Image Preview Modal -->
    <div class="modal hidden" id="imageModal">
        <div class="modal-backdrop"></div>
        <div class="modal-content image-modal-content">
            <button class="modal-close" id="imageModalClose">&times;</button>
            <img id="imageModalImg" src="" alt="Preview" />
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal hidden" id="deleteModal" role="alertdialog" aria-modal="true" aria-labelledby="delete-title" aria-describedby="delete-desc">
        <div class="modal-backdrop"></div>
        <div class="modal-content delete-modal-content">
            <div class="modal-header">
                <h3 id="delete-title">Delete Session</h3>
                <button class="modal-close" id="deleteModalClose" aria-label="Close dialog">&times;</button>
            </div>
            <div class="modal-body">
                <p id="delete-desc">Are you sure you want to delete this session? This action cannot be undone.</p>
            </div>
            <div class="modal-footer">
                <div class="modal-actions">
                    <button class="btn btn-secondary" id="cancelDeleteBtn">Cancel</button>
                    <button class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notifications Container -->
    <div class="toast-container" id="toastContainer" aria-live="polite" aria-atomic="true"></div>

    <script src="/static/js/app.js"></script>
</body>
</html>
